{% extends 'base.html' %}

{% block title %}Product List{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Product List</h2>
        <a href="{% url 'product_create' %}" class="btn btn-success">+ Add Product</a>
    </div>

    <input type="text" id="searchInput" class="form-control mb-3" placeholder="Search product...">

    <table class="table table-bordered table-striped text-center" id="productTable">
        <thead class="table-dark">
            <tr>
                <th onclick="sortTable(0)" class="text-center">Image</th>
                <th onclick="sortTable(1)" class="text-center">Name</th>
                <th class="text-center">Price</th>
                <th class="text-center">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for product in products %}
            <tr>
                <td class="text-center">
                    <img src="{{ product.product_image.url }}" width="80" height="80" alt="{{ product.name }}" class="img-thumbnail preview-img" data-bs-toggle="modal" data-bs-target="#imageModal" data-img="{{ product.product_image.url }}">
                </td>
                <td class="text-center" style="padding-top: 20px;"><strong>{{ product.name }}</strong></td>
                <td class="text-center" style="padding-top: 20px;">
                    {% if product.selling_price is not None and product.selling_price > 0 %}
                        ₹{{ product.selling_price }}
                    {% elif "milkshake" in product.category.name|lower or "pizza" in product.category.name|lower %}
                        {% if product.price_medium is not None and product.price_medium > 0 %}
                            ₹{{ product.price_medium }}
                        {% else %}
                            <span class="text-muted">N/A</span>
                        {% endif %}
                    {% elif "cake" in product.category.name|lower %}
                        {% if product.price_one_kg is not None and product.price_one_kg > 0 %}
                            ₹{{ product.price_one_kg }}
                        {% else %}
                            <span class="text-muted">N/A</span>
                        {% endif %}
                    {% else %}
                        <span class="text-muted">N/A</span>
                    {% endif %}
                </td>
                <td class="text-center" style="padding-top: 20px;">
                    <a href="{% url 'product_update' product.id %}" class="btn btn-sm btn-primary">Edit</a>
                    <a href="{% url 'product_delete' product.id %}" class="btn btn-sm btn-danger">Delete</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>

<!-- Modal for Image Preview -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <img src="" id="modalImage" class="img-fluid rounded">
    </div>
  </div>
</div>
{% endblock %}